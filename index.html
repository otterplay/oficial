<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="OtterPlay - Streaming de anime con sistema de monedas inteligente">
    <meta name="theme-color" content="#0a1a2a">
    <title>OtterPlay | Streaming</title>
    <link rel="icon" type="image/png" href="https://img.icons8.com/color/96/000000/otter.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&family=Inter:wght@400;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Modal de Permisos -->
    <div class="permission-modal hidden" id="permissionModal">
        <div class="modal-content">
            <div class="modal-header" style="padding: 1.5rem; border-bottom: 1px solid rgba(255,255,255,0.1);">
                <h3><i class="fas fa-shield-alt"></i> Permisos</h3>
            </div>
            <div class="modal-body" style="padding: 1.5rem;">
                <p style="margin-bottom: 1rem; color: var(--text-dim);">Para una mejor experiencia, necesitamos:</p>
                <ul style="list-style: none; margin-bottom: 1.5rem; display: grid; gap: 0.75rem;">
                    <li><i class="fas fa-check" style="color: var(--accent);"></i> Geolocalización</li>
                    <li><i class="fas fa-check" style="color: var(--accent);"></i> Notificaciones</li>
                </ul>
                <div style="display: grid; gap: 0.75rem;">
                    <button class="btn btn-primary" id="grantPermissions">Permitir</button>
                    <button class="btn" id="skipPermissions" style="background: rgba(255,255,255,0.05); color: var(--text-dim);">Saltar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Pantalla de Bienvenida -->
    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-container">
            <header class="logo-header">
                <h1>OtterPlay</h1>
                <p style="color: var(--text-dim);">El río del anime sin límites</p>
            </header>
            <div class="access-options">
                <div class="option-card" id="freeAccess">
                    <h3 style="margin-bottom: 1rem;"><i class="fas fa-water"></i> Nado Libre</h3>
                    <ul style="list-style: none; margin-bottom: 1.5rem; font-size: 0.9rem; color: var(--text-dim); display: grid; gap: 0.5rem;">
                        <li><i class="fas fa-check"></i> 300 gotas iniciales</li>
                        <li><i class="fas fa-check"></i> Todo el anime gratis</li>
                        <li><i class="fas fa-info-circle"></i> Consumo: 50 gotas/día</li>
                    </ul>
                    <button class="btn btn-primary option-select" id="freeBtn" data-option="free" style="width: 100%;">Acceso Rápido</button>
                </div>
                <div class="option-card vip" id="vipAccess">
                    <h3 style="margin-bottom: 1rem; color: var(--gold);"><i class="fas fa-crown"></i> Manada Otter</h3>
                    <ul style="list-style: none; margin-bottom: 1.5rem; font-size: 0.9rem; color: var(--text-dim); display: grid; gap: 0.5rem;">
                        <li><i class="fas fa-check" style="color: var(--gold);"></i> 3000 gotas (1 mes)</li>
                        <li><i class="fas fa-check" style="color: var(--gold);"></i> Sin bloqueos de IP</li>
                        <li><i class="fas fa-check" style="color: var(--gold);"></i> Contenido exclusivo</li>
                    </ul>
                    <button class="btn btn-vip option-select" id="vipBtn" data-option="vip" style="width: 100%;">250 CUP/mes</button>
                </div>
            </div>
            <div id="vipPreview" style="margin-top: 2rem; display: flex; gap: 0.5rem; overflow-x: auto; padding-bottom: 0.5rem;"></div>
        </div>
    </div>

    <!-- App Principal -->
    <div class="app-container hidden" id="appContainer">
        <header class="app-header">
            <div class="header-main">
                <div class="brand"><i class="fas fa-otter"></i> OtterPlay</div>
                <div class="user-section">
                    <div class="coins-display">
                        <i class="fas fa-water"></i>
                        <span id="coinsAmount">300</span>
                    </div>
                    <div class="user-profile" style="display: flex; align-items: center; gap: 0.5rem;">
                        <div id="userAvatar" style="width: 32px; height: 32px; background: var(--accent); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: bold;">O</div>
                        <div class="user-info" id="userStatus">
                            <span id="userName" style="font-size: 0.9rem; font-weight: 600; display: block;">Usuario</span>
                            <span id="statusText" style="font-size: 0.7rem; color: var(--success);">Nadando</span>
                        </div>
                    </div>
                    <button id="logoutBtn" style="background: none; border: none; color: var(--error); cursor: pointer;"><i class="fas fa-sign-out-alt"></i></button>
                </div>
            </div>
            <nav class="nav-tabs">
                <button class="nav-tab active" data-tab="trending"><i class="fas fa-fire"></i><span>Trending</span></button>
                <button class="nav-tab" data-tab="airing"><i class="fas fa-satellite-dish"></i><span>Emisión</span></button>
                <button class="nav-tab" data-tab="upcoming"><i class="fas fa-calendar-alt"></i><span>Próximos</span></button>
                <button class="nav-tab" data-tab="favorites"><i class="fas fa-star"></i><span>Favoritos</span></button>
            </nav>
        </header>

        <main class="app-main">
            <section class="hero-banner">
                <div class="hero-content">
                    <h2 id="heroTitle">Sumérgete en el Anime</h2>
                    <p id="heroSubtitle" style="font-size: 0.9rem; color: var(--text-dim);">Miles de series sin anuncios.</p>
                    <div class="hero-stats">
                        <div class="stat"><i class="fas fa-clock"></i> <span id="daysLeft">6 días</span></div>
                        <div class="stat"><i class="fas fa-sync-alt"></i> <span id="lastUpdate">Ahora</span></div>
                    </div>
                </div>
                <div class="hero-actions">
                    <button class="btn btn-vip" id="upgradeBtn"><i class="fas fa-crown"></i> VIP</button>
                    <button class="btn" id="refreshContent" style="background: rgba(255,255,255,0.05); color: white;"><i class="fas fa-sync-alt"></i></button>
                </div>
            </section>

            <section class="content-section">
                <header class="section-header">
                    <h3 id="sectionTitle">Anime Trending</h3>
                    <div style="display: flex; gap: 0.5rem;">
                        <select id="genreFilter" style="background: var(--bg-card-alt); color: white; border: 1px solid rgba(255,255,255,0.1); border-radius: 4px; padding: 0.25rem 0.5rem; font-size: 0.8rem;">
                            <option value="">Géneros</option>
                        </select>
                        <div class="view-toggle" style="display: flex; background: rgba(255,255,255,0.05); border-radius: 4px; padding: 2px;">
                            <button class="view-btn active" data-view="grid" style="background: none; border: none; color: white; padding: 4px; cursor: pointer;"><i class="fas fa-th-large"></i></button>
                            <button class="view-btn" data-view="list" style="background: none; border: none; color: var(--text-dim); padding: 4px; cursor: pointer;"><i class="fas fa-list"></i></button>
                        </div>
                    </div>
                </header>
                <div class="content-container grid-view" id="contentContainer"></div>
                <div class="loading-indicator hidden" id="loadingIndicator"><div class="spinner"></div></div>
                <div id="loadMore" style="text-align: center; margin-top: 2rem;">
                    <button class="btn btn-primary" id="loadMoreBtn">Cargar más</button>
                </div>
            </section>
        </main>
    </div>

    <!-- Modales -->
    <div class="player-modal hidden" id="playerModal">
        <div class="modal-overlay" id="modalOverlay"></div>
        <div class="modal-content" style="max-width: 800px; position: relative; z-index: 1001;">
            <div class="modal-header" style="padding: 1rem; display: flex; justify-content: space-between; align-items: center;">
                <h3 id="animeTitle">Título</h3>
                <button id="closeModal" style="background: none; border: none; color: white; font-size: 1.2rem; cursor: pointer;"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" style="padding: 1rem;">
                <div class="anime-player">
                    <div style="background: #000; aspect-ratio: 16/9; border-radius: 8px; display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 1rem;">
                        <i class="fas fa-play-circle" style="font-size: 3rem; color: var(--accent);"></i>
                        <p style="font-size: 0.8rem; color: var(--text-dim);">Reproductor OtterPlay</p>
                    </div>
                    <div class="player-info">
                        <div style="display: none;">
                            <span id="infoEpisodes"></span>
                            <span id="infoGenre"></span>
                            <span id="infoStudio"></span>
                            <span id="infoRating"></span>
                        </div>
                        <p id="infoSynopsis" style="font-size: 0.85rem; color: var(--text-dim); margin-bottom: 1rem; max-height: 100px; overflow-y: auto;"></p>
                        <div class="episode-selector">
                            <h4 style="font-size: 0.9rem; margin-bottom: 0.5rem;">Episodios</h4>
                            <div class="episode-grid" id="episodeGrid"></div>
                        </div>
                    </div>
                </div>
                <div style="display: none;">
                    <a href="#" class="platform"></a>
                </div>
                <button class="btn btn-primary" id="playEpisodeBtn" style="width: 100%; margin-top: 1rem;">Reproducir</button>
            </div>
        </div>
    </div>

    <div class="upgrade-modal hidden" id="upgradeModal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="position: relative; z-index: 1001;">
            <div class="modal-header" style="padding: 1rem; display: flex; justify-content: space-between; align-items: center;">
                <h3><i class="fas fa-crown"></i> VIP</h3>
                <button id="closeUpgrade" style="background: none; border: none; color: white; cursor: pointer;"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body" style="padding: 1rem; text-align: center;">
                <p style="margin-bottom: 1rem;">Desbloquea todo el potencial de OtterPlay.</p>
                
                <div class="payment-qr-container" style="background: white; padding: 1rem; border-radius: 12px; margin-bottom: 1rem; display: inline-block;">
                    <!-- Aquí irá el código QR de Transfermóvil -->
                    <img id="paymentQR" src="qr_transfermovil.jpg" alt="QR de Pago Transfermóvil" style="width: 200px; height: 200px; display: block; object-fit: contain;">
                </div>
                
                <div style="background: rgba(255,255,255,0.05); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; text-align: left; font-size: 0.85rem;">
                    <p style="color: var(--gold); font-weight: bold; margin-bottom: 0.5rem;"><i class="fas fa-info-circle"></i> Instrucciones:</p>
                    <ol style="padding-left: 1.2rem; color: var(--text-dim); display: grid; gap: 0.4rem;">
                        <li>Escanea el QR con <strong>Transfermóvil</strong>.</li>
                        <li>Realiza el pago de <strong>250 CUP</strong>.</li>
                        <li>Presiona el botón de abajo para activar.</li>
                    </ol>
                </div>

                <button class="btn btn-vip" id="confirmPayment" style="width: 100%;">He realizado el pago</button>
                <p style="font-size: 0.7rem; color: var(--text-dim); margin-top: 0.8rem;">La activación es instantánea tras la confirmación.</p>
            </div>
        </div>
    </div>

    <div class="block-modal hidden" id="blockModal">
        <div class="modal-overlay"></div>
        <div class="modal-content" style="position: relative; z-index: 1001;">
            <div class="modal-body" style="padding: 2rem; text-align: center;">
                <i class="fas fa-ban" style="font-size: 3rem; color: var(--error); margin-bottom: 1rem;"></i>
                <h3>¡Gotas agotadas!</h3>
                <p style="color: var(--text-dim); margin: 1rem 0;">Tu acceso gratuito ha terminado para hoy.</p>
                <code id="blockedIP" style="display: block; background: #000; padding: 0.5rem; border-radius: 4px; margin-bottom: 1.5rem;"></code>
                <button class="btn btn-vip" id="blockVipBtn" style="width: 100%;">Desbloquear con VIP</button>
            </div>
        </div>
    </div>

    <div id="notifications"></div>
    
    <script src="https://unpkg.com/dexie/dist/dexie.js"></script>
    <script src="script.js"></script>
</body>
</html>
